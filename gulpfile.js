"use strict";function checkEncryptedLayout(e,r){var t=e.split("\n"),i=!1;t.forEach(function(e){var r="layout:",t=e.indexOf(r),n=t>=0,u=e.indexOf("encrypted")>=t+r.length;n&&(i=!!u)}),i||console.log("[WARNING] "+r+": protected file not using encrypted layout.")}function encrypt(e){return through.obj(function(r,t,i){if(r.isNull()||r.isDirectory())return this.push(r),i();if(r.isStream())return this.emit("error",new PluginError({plugin:"Encrypt",message:"Streams are not supported."})),i();if(r.isBuffer()){var n="---",u=String(r.contents).split(n),p=u[0],l="";if(3===u.length)checkEncryptedLayout(u[1],r.path),l=u[1],p=u[2];else if(u.length>1)return this.emit("error",new PluginError({plugin:"Encrypt",message:r.path+": protected file has invalid front matter."})),i();var s=cryptojs.AES.encrypt(marked(p),e),o=[n,l,"\n","encrypted: "+cryptojs.HmacSHA256(s.toString(),cryptojs.SHA256(e).toString()).toString()+s,"\n",n];return r.contents=new Buffer(o.join("")),this.push(r),i()}})}var gulp=require("gulp"),gutil=require("gulp-util"),rename=require("gulp-rename"),cryptojs=require("crypto-js"),marked=require("marked"),FileSystem=require("fs"),through=require("through2"),PluginError=gutil.PluginError;gulp.task("firewall:encrypt",()=>gulp.src("_protected/*.*").pipe(encrypt("supernodesecurities")).pipe(rename({extname:".md.priv"})).pipe(gulp.dest("_posts"))),gulp.task("firewall:watch",()=>{gulp.watch("_protected/*.*",gulp.series("firewall:encrypt"))}),gulp.task("firewall",gulp.series("firewall:encrypt","firewall:watch",()=>{})),gulp.task("default",gulp.series("firewall",()=>{}));